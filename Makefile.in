OS_REVISION := $(shell uname -r)
OS := $(shell uname -s)
ISA_TARGET := $(shell isainfo -k)
OS_ARCH := $(OS)_$(OS_REVISION)_$(ISA_TARGET)
OBJ_BASE := obj
OBJ_DIR := $(OBJ_BASE)/$(OS_ARCH)
prefix = @prefix@

SRC = check_samfs.c
BIN = $(OBJ_DIR)/check_samfs

CFLAGS = @samfs_inc@
LDFLAGS = -z ignore -L/opt/SUNWsamfs/lib -lfsmgmt -lcsn -L/usr/sfw/lib -lssl -R/opt/SUNWsamfs/lib -R/usr/sfw/lib  -R/usr/lib/fs/samfs

D_CHECK_OBJDIR = \
	if [ ! -z "$(BIN)" ]; then \
		[ -d $(OBJ_DIR) ] || mkdir -p $(OBJ_DIR); \
	fi
__dummy := $(shell $(D_CHECK_OBJDIR))

all: $(BIN)

$(BIN): src/$(SRC)
	$(CC) $(CFLAGS) $(LDFLAGS) src/$(SRC) -o $(BIN)

install:
	ginstall -d $(DESTDIR)/$(prefix)/nagios/libexec
	ginstall -m 755 $(BIN) $(DESTDIR)/$(prefix)/nagios/libexec

clean:
	rm -f $(BIN)

distclean: clean
	rm -rf autom4te.cache
	rm -f *.log
	rm -f config.status
